<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPA 專案資產歸檔模擬器 (完整版)</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #1a1a1a;
            color: #e2e8f0;
            margin: 0;
            padding: 0;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #2d2d2d; 
        }
        ::-webkit-scrollbar-thumb {
            background: #525252; 
            border-radius: 4px;
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-panel {
            background: rgba(40, 40, 40, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        /* Neon effects for Event vibe */
        .neon-text {
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .glow-border {
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.3);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- 資料設定 (Event Industry Data) ---
        
        const SCENARIOS = [
            {
                id: 'S01',
                title: '專案：Neon City 沉浸式光影藝術展',
                status: 'TERMINATED', 
                statusText: '專案腰斬',
                description: '原定於松菸舉辦的年度大展，因授權金談判破裂，且場地消防安檢兩次未過，於開展前一週緊急喊卡。前期投入的行銷與設計費用全數認賠。',
                feedback: '策展最怕「死在最後一哩路」。失敗的專案中，場地法規的教訓與設計資產是未來東山再起的關鍵。',
                artifacts: [
                    { 
                        id: 'a1', 
                        name: '展場動線規劃圖 (AutoCAD)', 
                        type: 'image', 
                        desc: '雖然展覽沒辦成，但這套「雙迴路」的動線設計邏輯非常流暢。',
                        correctTarget: 'tool', 
                        tags: ['展場設計', '動線規劃', '場地圖Template'],
                        wrongTags: ['失敗展覽', '施工圖', '松菸平面圖'],
                        reason: '好的動線邏輯是通用的，將其去識別化後，可作為未來類似展覽的規劃模板。'
                    },
                    { 
                        id: 'a2', 
                        name: '消防局限期改善通知單.pdf', 
                        type: 'doc', 
                        desc: '清楚列出了哪些裝潢材質不符合法規，導致執照發不下來。',
                        correctTarget: 'lesson', 
                        tags: ['場地法規', '消防安檢', '風險管理'],
                        wrongTags: ['公文', '罰單', '政府文件'],
                        reason: '這是血淋淋的教訓！歸檔此文件能讓未來的策展人知道「哪些材質不能用」，避免重蹈覆徹。'
                    },
                    { 
                        id: 'a3', 
                        name: '開幕記者會媒體名單 (未發送)', 
                        type: 'doc', 
                        desc: '原本預計邀請的 KOL 與記者名單，包含聯絡窗口。',
                        correctTarget: 'tool', 
                        tags: ['媒體資料庫', 'KOL名單', '公關資源'],
                        wrongTags: ['記者會', '聯絡人', '未執行清單'],
                        reason: '這份名單是透過人脈整理出來的，雖然活動取消，但名單本身是極具價值的公關資產。'
                    },
                    { 
                        id: 'a4', 
                        name: '展場施工廢棄物清運單據', 
                        type: 'misc', 
                        desc: '廠商拆除裝潢後的垃圾清運收據。',
                        correctTarget: 'trash', 
                        tags: ['報帳單據', '施工雜支', '財務憑證'], 
                        wrongTags: ['重要合約', '廠商名單', '展覽紀錄'],
                        reason: '這屬於財務結報的單據，若無特殊爭議，對未來的策展規劃沒有參考價值，屬於雜訊。'
                    }
                ]
            },
            {
                id: 'S02',
                title: '專案：Summer Vibe 沙灘音樂節',
                status: 'COMPLETED', 
                statusText: '順利落幕',
                description: '活動票房完售，現場氣氛極佳。但因突發暴雨導致進場延誤，且藝人超時演出導致被環保局開罰，後台便當也不夠吃，工作人員怨聲載道。',
                feedback: '活動辦完不是結束，混亂的現場執行經驗，修正後將成為下一次活動的「完美SOP」。',
                artifacts: [
                    { 
                        id: 'b1', 
                        name: '活動細流表 (Run-down) Final', 
                        type: 'doc', 
                        desc: '包含燈光、音響、藝人上下台的精確時間表，雖然現場有Delay，但格式很完整。',
                        correctTarget: 'process', 
                        tags: ['活動SOP', 'Rundown範本', '場控流程'],
                        wrongTags: ['時間表', '當日流程', '音樂節檔案'],
                        reason: '將這次混亂中修正過的 Run-down 整理成標準範本，能讓下次的場控更精準。'
                    },
                    { 
                        id: 'b2', 
                        name: '硬體需求表 (Tech Rider)', 
                        type: 'doc', 
                        desc: '主舞台的燈光、音響、電力需求規格書，廠商依此搭建。',
                        correctTarget: 'tool', 
                        tags: ['硬體規格', 'Tech Rider', '舞台工程'],
                        wrongTags: ['廠商報價', '音響清單', '器材表'],
                        reason: '這是一份專業的規格書，留存下來可作為未來評估類似規模舞台預算的快速參考。'
                    },
                    { 
                        id: 'b3', 
                        name: '環保局噪音罰單 & 檢討報告', 
                        type: 'doc', 
                        desc: '因為超時和分貝過大被開罰的紀錄，以及原因分析。',
                        correctTarget: 'lesson', 
                        tags: ['危機處理', '場地風險', '法規限制'],
                        wrongTags: ['罰款', '檢討會', '收據'],
                        reason: '針對場地限制的寶貴經驗。未來在此地辦活動時，必須依據此教訓調整音響配置與演出時間。'
                    },
                    { 
                        id: 'b4', 
                        name: '工作人員吃剩的便當盒', 
                        type: 'misc', 
                        desc: '後台休息室堆積如山的垃圾照片。',
                        correctTarget: 'trash', 
                        tags: ['現場紀錄', '垃圾', '後台照片'],
                        wrongTags: ['餐飲紀錄', '便當廠商', '物資清單'],
                        reason: '除非要做「廚餘量分析」，否則這只是垃圾。真正有價值的是「便當數量統計表」而非垃圾本身。'
                    }
                ]
            },
            {
                id: 'S03',
                title: '專案：Galaxy S25 旗艦機新品發表會',
                status: 'COMPLETED', 
                statusText: '超支結案',
                description: '發表會畫面華麗，媒體曝光度極高。但因執行期間 CEO 臨時要求增加「全息投影」特效，導致硬體預算嚴重超支 30%，且與廠商有追加款項爭議。',
                feedback: '面對「成功但失控」的專案，歸檔重點在於「預算分析」與「變更控制紀錄」，以保護 PM 未來免受責難。',
                artifacts: [
                    { 
                        id: 'c1', 
                        name: '全息投影硬體架設圖', 
                        type: 'image', 
                        desc: '這套投影架構非常新穎，雖然貴，但效果震撼全場。',
                        correctTarget: 'tool', 
                        tags: ['硬體架構', '創新科技', '特效廠商清單'],
                        wrongTags: ['超支原因', '投影圖', '現場照片'],
                        reason: '創新的硬體架構是公司的技術資產。保留下來，下次如果預算充足，可以直接套用。'
                    },
                    { 
                        id: 'c2', 
                        name: '預算追加差異分析報告 (Variance Analysis)', 
                        type: 'doc', 
                        desc: '詳細列出預算超支是因為「高層臨時變更」而非 PM 估算錯誤。',
                        correctTarget: 'lesson', 
                        tags: ['成本管理', '預算差異分析', '變更紀錄'],
                        wrongTags: ['結案報告', '請款單', '檢討報告'],
                        reason: '這是 PM 的保命符，也是重要的教訓：未來面對高層臨時需求，必須先簽核「預算變更單」。'
                    },
                    { 
                        id: 'c3', 
                        name: '舊版流程 Run-down (v1~v5)', 
                        type: 'doc', 
                        desc: '被修改過無數次的舊版流程表，跟最終版完全不同。',
                        correctTarget: 'trash', 
                        tags: ['過期文件', '舊版', '作廢'],
                        wrongTags: ['參考流程', '完整紀錄', '備份'],
                        reason: '容易混淆的舊版本應清除或封存至冷資料區，OPA 只需保留「最終執行版 (Final Version)」。'
                    },
                    { 
                        id: 'c4', 
                        name: '緊急追加報價單 & 議價紀錄', 
                        type: 'doc', 
                        desc: '為了趕工，跟廠商緊急協調後的報價紀錄與合約增補條款。',
                        correctTarget: 'process', 
                        tags: ['緊急採購流程', '合約變更SOP', '議價案例'],
                        wrongTags: ['報價單', '廠商合約', '發票'],
                        reason: '這次的緊急採購雖然混亂，但建立了一個「緊急應變採購模式」，可優化為組織的緊急採購 SOP。'
                    }
                ]
            }
        ];

        const TARGETS = [
            { id: 'tool', name: '資源/工具庫', icon: 'wrench', desc: '可重複使用的設計圖、名單、硬體規格 (Assets)' },
            { id: 'process', name: '流程/SOP 優化', icon: 'git-merge', desc: 'Rundown 範本、工作手冊更新 (Process)' },
            { id: 'lesson', name: '經驗/避雷指南', icon: 'book-open', desc: '場地地雷、法規限制、危機處理紀錄 (Lessons)' },
            { id: 'trash', name: '雜訊回收桶', icon: 'trash-2', desc: '無參考價值的單據、過期手稿 (Noise)' }
        ];

        // --- Icon Component ---
        const Icon = ({ name, size = 20, className = "" }) => {
            React.useEffect(() => {
                lucide.createIcons();
            }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // --- Main Component ---
        const App = () => {
            const [stage, setStage] = useState('start'); // start, game, tagging, result, finalReport
            const [scenarioIndex, setScenarioIndex] = useState(0);
            const [scenario, setScenario] = useState(null);
            const [currentArtifactIndex, setCurrentArtifactIndex] = useState(0);
            const [decisions, setDecisions] = useState({}); 
            const [selectedTag, setSelectedTag] = useState(null);
            const [totalHistory, setTotalHistory] = useState([]); // Array of result logs from all scenarios

            // Start Game (Reset everything)
            const startGame = () => {
                setScenarioIndex(0);
                setTotalHistory([]);
                loadScenario(0);
            };

            const loadScenario = (index) => {
                setScenario(SCENARIOS[index]);
                setStage('game');
                setCurrentArtifactIndex(0);
                setDecisions({});
            };

            const nextScenario = () => {
                const nextIndex = scenarioIndex + 1;
                if (nextIndex < SCENARIOS.length) {
                    setScenarioIndex(nextIndex);
                    loadScenario(nextIndex);
                } else {
                    setStage('finalReport');
                }
            };

            // Handle Sorting
            const handleSort = (targetId) => {
                const currentArtifact = scenario.artifacts[currentArtifactIndex];
                const newDecisions = { ...decisions };
                newDecisions[currentArtifact.id] = { target: targetId, tag: null };
                setDecisions(newDecisions);

                if (targetId === 'trash') {
                    nextArtifact();
                } else {
                    setStage('tagging');
                    setSelectedTag(null);
                }
            };

            // Handle Tagging
            const handleTag = (tag) => {
                const currentArtifact = scenario.artifacts[currentArtifactIndex];
                const newDecisions = { ...decisions };
                newDecisions[currentArtifact.id].tag = tag;
                setDecisions(newDecisions);
                
                setTimeout(() => {
                    nextArtifact();
                }, 300);
            };

            const nextArtifact = () => {
                if (currentArtifactIndex + 1 < scenario.artifacts.length) {
                    setCurrentArtifactIndex(prev => prev + 1);
                    setStage('game');
                } else {
                    setStage('result');
                }
            };

            // Calculate Single Scenario Result
            const calculateScenarioResult = () => {
                let score = 0;
                let log = [];

                scenario.artifacts.forEach(artifact => {
                    const decision = decisions[artifact.id];
                    let itemScore = 0;
                    let message = "";
                    let isCorrect = false;

                    // Target Check
                    if (decision.target === artifact.correctTarget) {
                        itemScore += 10;
                        isCorrect = true;
                        message = "歸類正確！";
                    } else {
                        // NEW LOGIC: Tell the correct target
                        const correctTargetName = TARGETS.find(t => t.id === artifact.correctTarget)?.name;
                        message = `歸類錯誤 (應為：${correctTargetName})。`;
                    }

                    // Tag Check logic
                    if (artifact.correctTarget !== 'trash') {
                        if (decision.target === 'trash') {
                             message = "丟棄了珍貴資產！";
                             itemScore -= 5;
                             isCorrect = false;
                        } else if (artifact.tags.includes(decision.tag)) {
                            itemScore += 10;
                            message += " 關鍵字精準。";
                        } else if (decision.target === artifact.correctTarget) {
                            itemScore += 5;
                            message += " 標籤模糊。";
                        }
                    } else {
                         if (decision.target !== 'trash') {
                             // This is already covered by the target check above
                             // but we can add specific noise feedback if needed
                             message += " 保留了雜訊。"; 
                             itemScore -= 5;
                         } else {
                             message = "成功清除。"; // Override "Correct" for trash if needed, or keep as is
                             itemScore += 5; 
                         }
                    }

                    score += itemScore;
                    log.push({
                        name: artifact.name,
                        score: itemScore,
                        message: message,
                        reason: artifact.reason,
                        isCorrect: isCorrect,
                        userChoice: TARGETS.find(t => t.id === decision.target)?.name
                    });
                });

                return { score, log, scenarioTitle: scenario.title };
            };

            // Save result to history when entering result screen
            useEffect(() => {
                if (stage === 'result') {
                    const result = calculateScenarioResult();
                    setTotalHistory(prev => [...prev, result]);
                }
            }, [stage]);

            return (
                <div className="min-h-screen w-full flex flex-col items-center p-4 relative overflow-y-auto overflow-x-hidden text-slate-200">
                    {/* Background Elements */}
                    <div className="fixed inset-0 w-full h-full -z-20 opacity-50 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] pointer-events-none"></div>
                    <div className="fixed w-[500px] h-[500px] bg-pink-600/20 rounded-full blur-[100px] -top-20 -left-20 animate-pulse pointer-events-none"></div>
                    <div className="fixed w-[500px] h-[500px] bg-cyan-600/20 rounded-full blur-[100px] bottom-20 right-20 animate-pulse pointer-events-none" style={{animationDelay: '1s'}}></div>
                    <div className="fixed inset-0 -z-30 bg-gradient-to-br from-[#1a1a1a] via-[#2a2a2a] to-[#1a1a1a] pointer-events-none"></div>

                    {/* Header */}
                    <header className="w-full max-w-5xl flex items-center justify-between gap-2 text-slate-400 mb-8 pt-4">
                        <div className="flex items-center gap-2">
                            <Icon name="archive" className="text-pink-500" />
                            <span className="font-bold tracking-widest text-sm uppercase">Event OPA Simulator</span>
                        </div>
                        {stage !== 'start' && stage !== 'finalReport' && (
                            <div className="text-xs font-mono bg-slate-800 px-3 py-1 rounded-full border border-slate-700">
                                進度：專案 {scenarioIndex + 1} / {SCENARIOS.length}
                            </div>
                        )}
                    </header>

                    {/* Content Area */}
                    <div className="w-full flex flex-col items-center justify-center flex-1 pb-12">
                        {stage === 'start' && <StartScreen onStart={startGame} />}
                        {stage === 'game' && scenario && (
                            <SortingGame 
                                scenario={scenario} 
                                artifact={scenario.artifacts[currentArtifactIndex]}
                                progress={`${currentArtifactIndex + 1} / ${scenario.artifacts.length}`}
                                onSort={handleSort}
                            />
                        )}
                        {stage === 'tagging' && (
                            <TaggingScreen 
                                artifact={scenario.artifacts[currentArtifactIndex]}
                                onTag={handleTag}
                            />
                        )}
                        {stage === 'result' && (
                            <ResultScreen 
                                result={calculateScenarioResult()} 
                                isLast={scenarioIndex === SCENARIOS.length - 1}
                                onNext={nextScenario} 
                            />
                        )}
                        {stage === 'finalReport' && (
                            <FinalReportScreen 
                                history={totalHistory}
                                onRestart={startGame}
                            />
                        )}
                    </div>
                </div>
            );
        };

        const StartScreen = ({ onStart }) => (
            <div className="glass-panel p-10 rounded-2xl max-w-lg w-full text-center animate-fade-in border-t-2 border-pink-500/50 my-auto">
                <div className="mb-6 flex justify-center">
                    <div className="w-24 h-24 bg-gradient-to-br from-pink-500 to-purple-600 rounded-full flex items-center justify-center shadow-lg shadow-pink-500/30">
                        <Icon name="mic-2" size={48} className="text-white" />
                    </div>
                </div>
                <h1 className="text-4xl font-bold mb-4 text-white neon-text">專案結束與歸檔</h1>
                <p className="text-slate-300 mb-8 leading-relaxed text-lg">
                    在接下來的挑戰中，你將經歷 <span className="text-pink-400 font-bold">3 個不同的專案情境</span>。<br/>
                    無論是腰斬的展覽、混亂的音樂節，還是超支的發表會，你的任務只有一個：<br/>
                    <span className="text-cyan-400 font-semibold">為未來的自己留下最有價值的資產。</span>
                </p>
                <button 
                    onClick={onStart}
                    className="w-full bg-gradient-to-r from-pink-600 to-purple-600 hover:from-pink-500 hover:to-purple-500 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 hover:shadow-xl flex items-center justify-center gap-2 group text-lg"
                >
                    <Icon name="play" className="group-hover:fill-current" />
                    開始歸檔挑戰
                </button>
            </div>
        );

        const SortingGame = ({ scenario, artifact, progress, onSort }) => {
            const getArtifactIcon = (type) => {
                switch(type) {
                    case 'code': return 'file-code'; 
                    case 'doc': return 'file-text';
                    case 'image': return 'image';
                    case 'misc': return 'coffee';
                    default: return 'file';
                }
            };

            return (
                <div className="w-full max-w-5xl flex flex-col gap-6 animate-fade-in">
                    <div className="glass-panel p-6 rounded-xl border-l-4 border-cyan-500 flex justify-between items-start">
                        <div>
                            <div className="flex items-center gap-3 mb-2">
                                <span className={`text-sm px-3 py-1 rounded-full font-bold ${scenario.status === 'TERMINATED' ? 'bg-red-500/20 text-red-400 border border-red-500/30' : 'bg-green-500/20 text-green-400 border border-green-500/30'}`}>
                                    {scenario.statusText}
                                </span>
                                <h3 className="text-xl font-bold text-white">{scenario.title}</h3>
                            </div>
                            <p className="text-slate-300">{scenario.description}</p>
                        </div>
                        <div className="text-slate-500 font-mono text-sm bg-black/30 px-3 py-1 rounded">{progress}</div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-stretch min-h-[500px]">
                        <div className="flex justify-center h-full items-center py-4">
                            <div className="bg-gradient-to-b from-slate-800 to-slate-900 border border-slate-700 p-6 rounded-2xl shadow-2xl w-full max-w-sm hover:border-pink-500 transition-all relative group flex flex-col items-center text-center justify-center h-full min-h-[320px]">
                                <div className="absolute -top-3 bg-black px-4 py-1 rounded-full border border-slate-700 text-xs text-pink-400 uppercase tracking-wider font-bold">
                                    待處理資產
                                </div>
                                <div className="p-4 bg-slate-800 rounded-full mb-4 group-hover:scale-110 transition-transform shadow-inner shadow-black/50">
                                    <Icon name={getArtifactIcon(artifact.type)} size={48} className="text-cyan-400" />
                                </div>
                                <h2 className="text-xl font-bold text-white mb-2">{artifact.name}</h2>
                                <p className="text-slate-400 text-sm leading-relaxed">{artifact.desc}</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 gap-4 h-full content-center">
                            {TARGETS.map(target => (
                                <button 
                                    key={target.id}
                                    onClick={() => onSort(target.id)}
                                    className="p-6 rounded-xl border border-slate-700 bg-slate-800/40 hover:bg-slate-700 hover:border-cyan-500 transition-all text-left flex flex-col gap-3 group relative overflow-hidden min-h-[160px]"
                                >
                                    <div className="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
                                    <div className="flex items-center gap-3">
                                        <div className="p-3 bg-slate-800 rounded-lg group-hover:bg-cyan-600 transition-colors">
                                            <Icon name={target.icon} size={24} className="text-slate-300 group-hover:text-white" />
                                        </div>
                                        <span className="font-bold text-lg text-slate-100">{target.name}</span>
                                    </div>
                                    <p className="text-sm text-slate-400 pl-1">{target.desc}</p>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        const TaggingScreen = ({ artifact, onTag }) => {
            const options = [...artifact.tags, ...artifact.wrongTags].sort(() => Math.random() - 0.5);

            return (
                <div className="glass-panel p-10 rounded-2xl max-w-lg w-full animate-fade-in shadow-2xl border-t border-cyan-500/30 text-center my-auto">
                    <div className="mb-6 text-cyan-400 flex justify-center">
                        <Icon name="tag" size={48} />
                    </div>
                    <h2 className="text-3xl font-bold mb-4">設定檢索標籤</h2>
                    <p className="text-slate-400 mb-8 text-base">
                        你決定保留「<span className="text-white font-bold">{artifact.name}</span>」。<br/>
                        為了讓 3 年後的策展人能搜尋到，請貼上最精準的標籤：
                    </p>

                    <div className="grid grid-cols-1 gap-3 mb-6">
                        {options.map((tag, idx) => (
                            <button 
                                key={idx}
                                onClick={() => onTag(tag)}
                                className="w-full py-4 px-6 rounded-xl bg-slate-800 border border-slate-600 hover:border-cyan-500 hover:bg-slate-700 text-slate-200 transition-all flex items-center justify-between group text-lg"
                            >
                                <span className="font-mono">#{tag}</span>
                                <Icon name="check-circle" size={20} className="opacity-0 group-hover:opacity-100 text-cyan-400" />
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const ResultScreen = ({ result, isLast, onNext }) => {
            return (
                <div className="w-full max-w-4xl animate-fade-in pb-10">
                    <div className="text-center mb-10">
                        <div className="inline-block px-5 py-2 rounded-full bg-cyan-900/30 text-cyan-300 text-sm font-mono mb-6 border border-cyan-800">
                            本階段分數
                        </div>
                        <h2 className="text-4xl font-bold text-white mb-2">{result.scenarioTitle}</h2>
                        <div className="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-400 to-cyan-400 my-4">
                            {result.score} <span className="text-3xl text-slate-500">分</span>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 gap-4 mb-10">
                        {result.log.map((item, idx) => (
                            <div key={idx} className={`p-4 rounded-xl border ${item.isCorrect ? 'bg-slate-800/80 border-green-500/30' : 'bg-red-900/10 border-red-500/30'} flex flex-col md:flex-row gap-4 items-start`}>
                                <div className={`p-2 rounded-lg ${item.isCorrect ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'}`}>
                                    <Icon name={item.isCorrect ? 'check' : 'alert-triangle'} size={20} />
                                </div>
                                <div className="flex-1">
                                    <div className="flex justify-between items-start mb-1">
                                        <h4 className="font-bold text-white text-base">{item.name}</h4>
                                        <span className={`font-bold px-2 py-0.5 rounded text-xs ${item.score > 0 ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>
                                            {item.score > 0 ? '+' : ''}{item.score}
                                        </span>
                                    </div>
                                    <div className="text-sm text-slate-300 mb-2">
                                        <span className="font-mono text-xs bg-slate-700 px-2 py-1 rounded mx-1">{item.userChoice || 'N/A'}</span> 
                                        {item.message}
                                    </div>
                                    <div className="text-xs text-slate-400 bg-black/20 p-2 rounded border border-white/5">
                                        <strong className="text-cyan-400">OPA 觀點：</strong> {item.reason}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="flex justify-center">
                        <button 
                            onClick={onNext}
                            className="bg-slate-700 hover:bg-slate-600 text-white font-bold py-4 px-10 rounded-xl transition-all flex items-center gap-3 text-lg border border-slate-600 hover:border-white/50 glow-border"
                        >
                            {isLast ? "查看最終歸檔報告" : "進入下一個專案"}
                            <Icon name="arrow-right" size={20} />
                        </button>
                    </div>
                </div>
            );
        };

        const FinalReportScreen = ({ history, onRestart }) => {
            const totalScore = history.reduce((acc, curr) => acc + curr.score, 0);
            
            return (
                <div className="w-full max-w-4xl animate-fade-in pb-10">
                    <div className="glass-panel p-8 rounded-2xl mb-8 border-t-4 border-pink-500">
                        <div className="text-center">
                            <h2 className="text-3xl font-bold text-white mb-2">組織資產歸檔 - 最終報告</h2>
                            <p className="text-slate-400 mb-6">3 個專案的綜合評估結果</p>
                            
                            <div className="flex justify-center items-end gap-2 mb-6">
                                <span className="text-8xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-400 via-purple-400 to-cyan-400">
                                    {totalScore}
                                </span>
                                <span className="text-2xl text-slate-500 mb-4">/ 300 分</span>
                            </div>

                            <div className="bg-slate-800/50 p-6 rounded-xl text-left max-w-2xl mx-auto border border-slate-700">
                                <h3 className="text-xl font-bold text-white mb-3 flex items-center gap-2">
                                    <Icon name="user-check" className="text-cyan-400" />
                                    專家點評
                                </h3>
                                <p className="text-slate-300 leading-relaxed">
                                    {totalScore > 240 
                                        ? "完美！你具備了極佳的知識管理意識。不僅懂得區分什麼是「垃圾」與「資產」，更懂得透過標籤化（Tagging）讓未來的團隊能快速取用。你是組織中不可或缺的成熟 PM！" 
                                        : totalScore > 150 
                                            ? "表現不錯。你大致掌握了歸檔的邏輯，但在「經驗教訓（Lessons Learned）」的提煉上還可以更精準。記得，失敗的經驗往往比成功的檔案更有價值。" 
                                            : "還有進步空間。你的歸檔策略可能會導致資料庫充斥雜訊，或者重要經驗流失。建議重新複習 OPA 的三大分類原則。"}
                                </p>
                            </div>
                        </div>
                    </div>

                    {/* Educational Content Section */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                        <div className="bg-slate-800 p-6 rounded-xl border border-slate-700">
                            <h3 className="text-lg font-bold text-pink-400 mb-4 flex items-center gap-2">
                                <Icon name="alert-circle" />
                                為什麼要做經驗歸檔？
                            </h3>
                            <p className="text-sm text-slate-300 mb-4">
                                專案結束（Closing）不只是慶功宴。無論專案是正常結束、還是意外腰斬，如果不做歸檔，組織就會失憶，永遠在重複犯同樣的錯。
                            </p>
                            <ul className="text-sm text-slate-400 list-disc list-inside space-y-1">
                                <li>避免重複造輪子（如：重寫一樣的企劃書）</li>
                                <li>避免重複踩雷（如：再次找同一家雷廠商）</li>
                                <li>新人訓練成本降低</li>
                            </ul>
                        </div>

                        <div className="bg-slate-800 p-6 rounded-xl border border-slate-700">
                            <h3 className="text-lg font-bold text-cyan-400 mb-4 flex items-center gap-2">
                                <Icon name="check-square" />
                                歸檔的標準動作 (OPA)
                            </h3>
                            <div className="space-y-3">
                                <div className="flex gap-3">
                                    <div className="mt-1 bg-cyan-900/50 p-1 rounded text-cyan-300"><Icon name="file-text" size={16} /></div>
                                    <div>
                                        <h4 className="text-white font-bold text-sm">1. 專案檔案 (Project Files)</h4>
                                        <p className="text-xs text-slate-400">最終版的合約、驗收單、設計圖、名單。記得清除中間過程的雜訊。</p>
                                    </div>
                                </div>
                                <div className="flex gap-3">
                                    <div className="mt-1 bg-purple-900/50 p-1 rounded text-purple-300"><Icon name="git-merge" size={16} /></div>
                                    <div>
                                        <h4 className="text-white font-bold text-sm">2. 流程與SOP更新</h4>
                                        <p className="text-xs text-slate-400">如果這次發現原本的 SOP 不好用，請修正它，讓下個人用更好的版本。</p>
                                    </div>
                                </div>
                                <div className="flex gap-3">
                                    <div className="mt-1 bg-yellow-900/50 p-1 rounded text-yellow-300"><Icon name="book-open" size={16} /></div>
                                    <div>
                                        <h4 className="text-white font-bold text-sm">3. 經驗教訓 (Lessons Learned)</h4>
                                        <p className="text-xs text-slate-400">這是最重要的。記錄「發生了什麼」、「原因」、「未來如何預防」。</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex justify-center">
                        <button 
                            onClick={onRestart}
                            className="bg-slate-700 hover:bg-slate-600 text-white font-bold py-4 px-10 rounded-xl transition-all flex items-center gap-3 text-lg border border-slate-600 hover:border-white/50"
                        >
                            <Icon name="rotate-ccw" size={20} />
                            重新挑戰
                        </button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
