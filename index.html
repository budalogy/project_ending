<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Project Closure Questï½œå°ˆæ¡ˆçµ‚æ­¢ Ã— çµ„ç¹”è¨˜æ†¶ï¼ˆ6è¼ªï¼‰</title>
  <style>
    :root { --bg:#0f172a; --card:#111827; --ink:#e5e7eb; --ink2:#cbd5e1; --accent:#22d3ee; --muted:#475569; --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; }
    html,body{margin:0;height:100%;font-family: system-ui, -apple-system, "Segoe UI", Roboto, Noto Sans TC, Arial, sans-serif;background:var(--bg);color:var(--ink);} 
    .app{display:flex;flex-direction:column;min-height:100%}
    header{position:sticky;top:0;background:linear-gradient(180deg,#0b1222, #0f172a);border-bottom:1px solid #1f2937;z-index:5}
    .bar{display:flex;align-items:center;gap:.75rem;padding:.75rem 1rem;flex-wrap:wrap}
    .title{font-weight:700;letter-spacing:.3px}
    .pill{padding:.35rem .6rem;border-radius:999px;background:#0b1222;border:1px solid #1f2937;color:var(--ink2);font-size:.85rem}
    .score{margin-left:auto;display:flex;gap:.5rem;align-items:center}
    .btn{background:#0b1222;border:1px solid #1f2937;color:var(--ink);padding:.5rem .8rem;border-radius:.6rem;cursor:pointer}
    .btn:hover{border-color:#334155}
    .primary{background:linear-gradient(180deg,#0ea5e9,#0891b2);border-color:#0ea5e9}
    main{display:grid;grid-template-columns:280px 1fr;gap:1rem;padding:1rem}
    nav{position:sticky;top:62px;align-self:start}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:1rem}
    .nav a{display:flex;align-items:center;gap:.5rem;padding:.55rem .6rem;margin:.25rem 0;color:var(--ink2);text-decoration:none;border-radius:.5rem}
    .nav a.active{background:#0b1222;color:var(--ink);border:1px solid #334155}
    .tag{font-size:.75rem;color:var(--ink2);border:1px dashed #334155;border-radius:6px;padding:.15rem .4rem}
    h2{margin:.2rem 0 1rem 0}
    section{display:none}
    section.active{display:block}
    .cols{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem}
    .col{min-height:240px;background:#0b1222;border:1px dashed #334155;border-radius:10px;padding:.5rem}
    .hint{color:var(--ink2);font-size:.9rem}
    .item{background:#0f1a33;border:1px solid #334155;border-radius:10px;padding:.5rem;margin:.4rem 0;cursor:grab}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    label{display:block;margin:.35rem 0 .2rem .1rem;color:var(--ink2);font-size:.9rem}
    input[type="text"], textarea, select{width:100%;padding:.6rem;border-radius:.6rem;border:1px solid #334155;background:#0b1222;color:var(--ink)}
    textarea{min-height:120px}
    .list{display:grid;grid-template-columns:1fr;gap:.4rem}
    .check{display:flex;align-items:flex-start;gap:.6rem;padding:.4rem;border:1px solid #334155;border-radius:.6rem;background:#0b1222}
    .muted{color:var(--muted);font-size:.85rem}
    .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;background:#0b1222;border:1px solid #334155;padding:.15rem .35rem;border-radius:6px;font-size:.85rem;color:var(--ink2)}
    .row{display:flex;gap:.5rem;flex-wrap:wrap}
    .flex{display:flex;gap:.5rem;align-items:center}
    .right{margin-left:auto}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border:1px solid #334155;padding:.5rem;text-align:left}
    .small{font-size:.85rem}
    footer{padding:1rem;color:var(--ink2)}
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="bar">
      <div class="title">Project Closure Quest</div>
      <span class="pill">å°ˆæ¡ˆçµ‚æ­¢ Ã— çµ„ç¹”è¨˜æ†¶ï¼ˆ6è¼ªï¼‰</span>
      <span class="pill">å–®æª”ç‰ˆ Â· å…å®‰è£</span>
      <div class="score"><span>åˆ†æ•¸ï¼š</span><strong id="score">0</strong>
        <button class="btn" id="exportMd">åŒ¯å‡ºæˆæœ</button>
        <button class="btn" id="reset">é‡ç½®</button>
      </div>
    </div>
  </header>
  <main>
    <nav>
      <div class="card nav" id="nav"></div>
      <div class="card small">
        <div class="hint">æ“ä½œæç¤º</div>
        <ul>
          <li>ä¾å·¦å´é¸å–®ä¾åºé—–é—œï¼›æ¯é—œå®ŒæˆæœƒåŠ åˆ†ã€‚</li>
          <li>å¯éš¨æ™‚é»ã€ŒåŒ¯å‡ºæˆæœã€ä¸‹è¼‰ Markdown å ±å‘Šã€‚</li>
          <li>æœ¬æª”å¯ç›´æ¥æ”¾ Github Pagesï¼Œæª”å <span class="kbd">index.html</span>ã€‚</li>
        </ul>
      </div>
    </nav>
    <div>
      <!-- Lv1 æƒ…å¢ƒèˆ‡æ±ºç­–æ¨¹ -->
      <section id="lv1" class="card active">
        <h2>Lv1ï½œçµ‚æ­¢æƒ…å¢ƒ Ã— æ±ºç­–æ¨¹</h2>
        <p class="hint">æŠ½ä¸€å¼µæƒ…å¢ƒå¡ï¼Œå›ç­”äºŒåˆ†å•é¡Œï¼Œç”¢å‡º 6 å¥è©±çµ‚æ­¢æºé€šç¨¿ã€‚</p>
        <div class="row">
          <button class="btn" id="drawScenario">æŠ½æƒ…å¢ƒå¡</button>
          <span id="scenarioTag" class="tag"></span>
        </div>
        <div id="scenarioBox" class="card" style="margin-top: .8rem"></div>
        <div id="decisionBox" class="list" style="margin-top:.6rem"></div>
        <label>ä½ çš„ 6 å¥è©±çµ‚æ­¢æºé€šç¨¿<\/label>
        <textarea id=\"closureScript\" placeholder=\"1) æ±ºç­–äº‹å¯¦â€¦\n2) çµ‚æ­¢ç†ç”±ï¼ˆä»¥æ•¸æ“šï¼‰â€¦\n3) é¢¨éšªæ§ç®¡â€¦\n4) å°å—å½±éŸ¿è€…å®‰æ’â€¦\n5) å¾ŒçºŒé‡Œç¨‹ç¢‘â€¦\n6) è¯çµ¡çª—å£â€¦\"></textarea>
        <div class=\"card small\" style=\"margin:.6rem 0\">
          <div class=\"hint\">å¿«é€Ÿç”¢ç”Ÿå™¨ï¼ˆé»é¸ä¸‹åˆ—é¸é …ï¼ŒæŒ‰ä¸‹æ–¹æŒ‰éˆ•å³å¯è‡ªå‹•ç”¢ç”Ÿ 6 å¥è©±ï¼‰<\/div>
          <div class=\"grid2\">
            <div>
              <label>å—çœ¾</label>
              <select id=\"q_aud\">
                <option value=\"å…¨é«”åŒä»\">å…¨é«”åŒä»<\/option>
                <option value=\"å°ˆæ¡ˆç›¸é—œå¹²ä¿‚äºº\">å°ˆæ¡ˆç›¸é—œå¹²ä¿‚äºº<\/option>
                <option value=\"å®¢æˆ¶èˆ‡åˆä½œå¤¥ä¼´\">å®¢æˆ¶èˆ‡åˆä½œå¤¥ä¼´<\/option>
              </select>
              <label>çµ‚æ­¢é¡å‹<\/label>
              <select id=\"q_type\">
                <option value=\"æ­£å¸¸çµæ¡ˆ\">æ­£å¸¸çµæ¡ˆ<\/option>
                <option value=\"æå‰çµ‚æ­¢\">æå‰çµ‚æ­¢<\/option>
                <option value=\"å–æ¶ˆ\/ä¸­æ­¢\">å–æ¶ˆ\/ä¸­æ­¢<\/option>
                <option value=\"ç§»è½‰è‡³ç¶­é‹ï¼ˆBAUï¼‰\">ç§»è½‰è‡³ç¶­é‹ï¼ˆBAUï¼‰<\/option>
              <\/select>
              <label>é—œéµæ•¸æ“šï¼ˆæˆæ•ˆ/æˆæœ¬/é¢¨éšªï¼‰<\/label>
              <input id=\"q_data\" placeholder=\"ä¾‹ï¼šé”æˆKPI 92%ï¼Œé ä¼°æŒçºŒæˆæœ¬â†‘30%\" />
            <\/div>
            <div>
              <label>é¢¨éšªæ§ç®¡èˆ‡è£œæ•‘<\/label>
              <input id=\"q_mit\" placeholder=\"ä¾‹ï¼šè³‡æ–™å‚™ä»½å®Œæˆï¼Œä¾›æ‡‰å•†ä¿å›ºç¶­æŒè‡³ 2026-06-30\" />
              <label>å¾ŒçºŒé‡Œç¨‹ç¢‘ï¼ˆæ—¥æœŸï¼‰<\/label>
              <input id=\"q_next\" placeholder=\"ä¾‹ï¼š12\/20 å®Œæˆç§»äº¤ï¼›12\/27 æäº¤çµæ¡ˆå ±å‘Š\" />
              <label>è¯çµ¡çª—å£<\/label>
              <input id=\"q_contact\" placeholder=\"ä¾‹ï¼šPM ç‹å°æ˜ï¼ˆpm@example.comï¼‰\" />
            <\/div>
          <\/div>
          <div class=\"row\" style=\"margin-top:.5rem\">
            <button class=\"btn\" id=\"quickBuild\">ç”¨é»é¸å¿«é€Ÿç”Ÿæˆ<\/button>
          <\/div>
        <\/div>
        <div class=\"row\"> 
          <button class=\"btn primary\" data-finish=\"lv1\">å®Œæˆæ­¤é—œ<\/button>
        <\/div>
      <\/section>

      <!-- Lv2 DOR-Close æ‹–æ”¾ -->
      <section id="lv2" class="card">
        <h2>Lv2ï½œDOR-Closeï¼ˆæº–å‚™å°±ç·’ï¼‰æ‹–æ”¾æª¢æ ¸</h2>
        <p class="hint">æŠŠè¦ä»¶æ‹–é€²ã€Œå¿…å‚™/é¸é…/ä¸éœ€è¦ã€ã€‚ä¸¦è‡ªè¨‚ 3 æ¢ã€‚</p>
        <div class="cols">
          <div>
            <div class="hint">å€™é¸è¦ä»¶</div>
            <div id="dorPool"></div>
            <div class="row">
              <input id="customDor" placeholder="æ–°å¢è‡ªè¨‚è¦ä»¶â€¦" />
              <button class="btn" id="addDor">æ–°å¢</button>
            </div>
          </div>
          <div class="col" data-bucket="å¿…å‚™"><div class="hint">å¿…å‚™</div></div>
          <div class="col" data-bucket="é¸é…"><div class="hint">é¸é…</div></div>
          <div class="col" data-bucket="ä¸éœ€è¦"><div class="hint">ä¸éœ€è¦</div></div>
        </div>
        <div class="row" style="margin-top:.6rem">
          <button class="btn primary" data-finish="lv2">å®Œæˆæ­¤é—œ</button>
        </div>
      </section>

      <!-- Lv3 DOD-Close å‹¾é¸ -->
      <section id="lv3" class="card">
        <h2>Lv3ï½œDOD-Closeï¼ˆå®Œæˆå®šç¾©ï¼‰æŒ‘é¸</h2>
        <p class="hint">å¾å€™é¸æ¸…å–®æŒ‘ 10â€“12 æ¢ï¼Œä¸¦å° 3 æ¢åŠ ä¸Šã€Œè­‰æ“šå‹è£œè¿°ã€ã€‚</p>
        <div class="grid2">
          <div>
            <div class="list" id="dodList"></div>
          </div>
          <div>
            <label>è£œè¿°ï¼ˆæŒ‘ 3 æ¢å¯«è­‰æ“šé€£çµ/æª”æ¡ˆï¼‰</label>
            <div class="list" id="dodNotes"></div>
          </div>
        </div>
        <div class="row" style="margin-top:.6rem">
          <button class="btn primary" data-finish="lv3">å®Œæˆæ­¤é—œ</button>
        </div>
      </section>

      <!-- Lv4 Handover ç§»äº¤æ¨¡æ“¬ -->
      <section id="lv4" class="card">
        <h2>Lv4ï½œç§»äº¤æ¥æ£’æ¨¡æ“¬</h2>
        <p class="hint">è£œé½Š Ownerã€Review Date èˆ‡å¿…å‚™è³‡ç”¢æ¬„ä½ï¼Œå®Œæˆé»äº¤ã€‚</p>
        <div class="grid2">
          <div>
            <label>æ¥æ‰‹å–®ä½/Owner</label>
            <input id="owner" placeholder="e.g., ç¶­é‹çµ„ï¼ç‹å°æ˜" />
            <label>Review Dateï¼ˆä¸‹æ¬¡è¤‡å¯©æ—¥ï¼‰</label>
            <input id="review" type="date" />
            <label>å­˜æ”¾è·¯å¾‘/é€£çµ</label>
            <input id="repo" placeholder="é›²ç«¯è³‡æ–™å¤¾æˆ–Repoé€£çµ" />
          </div>
          <div>
            <div class="hint">å¿…å‚™è³‡ç”¢ï¼ˆè‡³å°‘å‹¾ 5 é …ï¼‰</div>
            <div class="list" id="assetList"></div>
          </div>
        </div>
        <div class="row" style="margin-top:.6rem">
          <button class="btn primary" data-finish="lv4">å®Œæˆæ­¤é—œ</button>
        </div>
      </section>

      <!-- Lv5 Lessons -> Template -->
      <section id="lv5" class="card">
        <h2>Lv5ï½œæŠŠæ•™è¨“è®Šæ¨¡æ¿ï¼ˆLessons â†’ SOP/Checklistï¼‰</h2>
        <p class="hint">å°‡å¿ƒå¾—æ”¹å¯«ç‚ºå¯æ“ä½œæ­¥é©Ÿèˆ‡æª¢æ ¸é …ã€‚</p>
        <div class="grid2">
          <div>
            <label>æ•™è¨“å­¸ç¿’ï¼ˆé€å­—ç¨¿/æ‘˜éŒ„ï¼‰</label>
            <textarea id="lessonsSrc">1) ä¸Šç·šå‰æœªå‡çµåå–®å°è‡´è¿”å·¥ã€‚
2) æŠ½çè…³æœ¬ç„¡å‚™æ´ï¼Œç›´æ’­å»¶é²ã€‚
3) ä¾›æ‡‰å•†é©—æ”¶æœªç•™å½±åƒï¼Œè«‹æ¬¾çˆ­è­°ã€‚</textarea>
          </div>
          <div>
            <label>SOP/Checklistï¼ˆè«‹ç”¨ã€Œåè©ï¼‹å‹•ä½œï¼‹è­‰æ“šã€å¥å‹ï¼‰</label>
            <textarea id="lessonsOut" placeholder="ä¾‹ï¼šæŠ½çåå–®å·²å®Œæˆç‰ˆæœ¬å‡çµï¼ˆæª”åèˆ‡æ™‚é–“æˆ³ï¼‰ï¼Œä¸Šå‚³é€£çµé™„æ–¼æ±ºç­–ç´€éŒ„ã€‚"></textarea>
          </div>
        </div>
        <div class="row">
          <button class="btn" id="autoRewrite">AI å¥å‹å°å¹«æ‰‹</button>
          <button class="btn primary right" data-finish="lv5">å®Œæˆæ­¤é—œ</button>
        </div>
      </section>

      <!-- Lv6 Findability å‘½åèˆ‡æ¨™ç±¤ -->
      <section id="lv6" class="card">
        <h2>Lv6ï½œæ‰¾å¾—åˆ°æ¸¬è©¦ï¼ˆå‘½åèˆ‡æ¨™ç±¤ï¼‰</h2>
        <p class="hint">ç‚º 5 ä»½æª”æ¡ˆé‡å‘½åä¸¦åŠ æ¨™ç±¤ï¼Œå†åš 60 ç§’æœå°‹æ¸¬è©¦ï¼ˆç°¡åŒ–ç‰ˆï¼‰ã€‚</p>
        <div class="list" id="fileList"></div>
        <div class="row" style="margin-top:.6rem">
          <button class="btn primary" data-finish="lv6">å®Œæˆæ­¤é—œ</button>
        </div>
      </section>

      <!-- ç¸½çµèˆ‡åŒ¯å‡ºé è¦½ -->
      <section id="summary" class="card">
        <h2>ç¸½çµèˆ‡åŒ¯å‡º</h2>
        <div id="preview" class="small"></div>
      </section>
    </div>
  </main>
  <footer>
    <div class="small">Â© 2025 Project Closure Quest â€” å–®æª”æ•™å­¸ç‰ˆã€‚æ­¤æª”ä¸ä¾è³´å¤–éƒ¨å¥—ä»¶ï¼Œæ”¯æ´ GitHub Pagesã€‚ä½œè€…ï¼šä½ å’Œä½ çš„åŠ©æ•™ ğŸ˜„</div>
  </footer>
</div>
<script>
// --- ç°¡æ˜“è³‡æ–™ ---
const state = {
  score: 0,
  finished: {},
  lv1: { scenario: null, answers: {}, script: "" },
  lv2: { buckets: {"å¿…å‚™":[],"é¸é…":[],"ä¸éœ€è¦":[]}},
  lv3: { chosen: [], notes: {} },
  lv4: { owner:"", review:"", repo:"", assets:[] },
  lv5: { src:"", out:"" },
  lv6: { files: [] }
};

const scenarios = [
  { id:"normal", title:"åŠŸèƒ½é”æˆï¼Œæ”¶å°¾çµæ¡ˆ", facts:["EVâ‰ˆPV","é—œéµå®¢æˆ¶æ»¿æ„","æŠ€è¡“å‚µä½"], questions:[
    {k:"mvp", q:"æ˜¯å¦å·²é”æœ€å°å¯è¡Œåƒ¹å€¼ï¼ˆMVPï¼‰ï¼Ÿ"},
    {k:"risk", q:"é‡å¤§é¢¨éšªæ˜¯å¦åœ¨å¯æ¥å—ç¯„åœï¼Ÿ"},
    {k:"alt", q:"æ˜¯å¦å­˜åœ¨æ›´é«˜ROIçš„æ›¿ä»£æ–¹æ¡ˆï¼Ÿ"}
  ]},
  { id:"early", title:"ç­–ç•¥è½‰å‘ï¼Œæå‰çµ‚æ­¢", facts:["æ–°ç”¢å“ç·šå‹å‡º","å¸‚å ´çª—å£æ”¹è®Š","å‰©é¤˜é ç®—æœ‰é™"], questions:[
    {k:"data", q:"æ˜¯å¦æœ‰æ•¸æ“šæ”¯æŒçµ‚æ­¢å„ªæ–¼çºŒæ¨ï¼Ÿ"},
    {k:"stake", q:"ä¸»è¦å¹²ä¿‚äººæ˜¯å¦ç†è§£å½±éŸ¿ä¸¦åŒæ„ï¼Ÿ"},
    {k:"plan", q:"æ˜¯å¦æœ‰å®Œå–„çš„é—œé–‰èˆ‡ç§»è½‰è¨ˆç•«ï¼Ÿ"}
  ]},
  { id:"cancel", title:"åˆè¦é¢¨éšªï¼Œå–æ¶ˆ/ä¸­æ­¢", facts:["GDPR ç–‘æ…®","å“ç‰Œé¢¨éšª","æ³•éµå¯©æŸ¥æœªé"], questions:[
    {k:"comp", q:"æ˜¯å¦å­˜åœ¨ä¸å¯æ¥å—çš„æ³•éµ/è³‡å®‰ç¼ºé™·ï¼Ÿ"},
    {k:"miti", q:"æ˜¯å¦å·²å˜—è©¦åˆç†ç·©è§£ä»ä¸å¯è¡Œï¼Ÿ"},
    {k:"com", q:"æ˜¯å¦æ“¬å®šå°å¤–æºé€šèˆ‡è£œæ•‘æ–¹æ¡ˆï¼Ÿ"}
  ]},
  { id:"ba u", title:"è½‰ç§»è‡³ç¶­é‹ï¼ˆBAUï¼‰", facts:["åŠŸèƒ½ç©©å®š","ç¶­è­·æˆæœ¬ä½","éœ€æ±‚é•·æœŸ"], questions:[
    {k:"sla", q:"æ˜¯å¦å®šç¾©ç‡Ÿé‹SLAèˆ‡ç¶­è­·çª—å£ï¼Ÿ"},
    {k:"handover", q:"è³‡ç”¢/å¸³è™Ÿ/ç’°å¢ƒæ˜¯å¦å¯ç§»äº¤ï¼Ÿ"},
    {k:"metrics", q:"æ˜¯å¦è¨­ç½®æŒçºŒç›£æ§èˆ‡KPIï¼Ÿ"}
  ]},
];

const dorPool = [
  "åˆç´„/æ¡è³¼æœªçµç¾©å‹™ç›¤é»å®Œæˆ",
  "è²¡å‹™é ä¼° vs å¯¦éš›æ”¶æ”¯ç›¤é»å®Œæˆ",
  "ç§»äº¤å°è±¡èˆ‡ SLA è‰æ¡ˆå°±ç·’",
  "è³‡å®‰/æ³•éµ/å“ç‰Œæ ¸å°æ¸…å–®å‚™å¦¥",
  "å¹²ä¿‚äººå°çµ‚æ­¢ç†ç”±èˆ‡ç¯„åœåˆæ­¥åŒæ„",
  "çµæ¡ˆæ–‡ä»¶éª¨æ¶å»ºç«‹ï¼ˆClosure/Handover/Lessonsï¼‰",
  "ç’°å¢ƒèˆ‡å¸³è™Ÿæ¸…å†Šåˆç¨¿",
  "é¢¨éšªæ®˜ç•™æ¸…å–®åˆç¨¿ï¼ˆOwner/æœŸé™ï¼‰"
];

const dodPool = [
  {t:"æ­£å¼é©—æ”¶èˆ‡ç°½èªå®Œæˆï¼ˆé™„é€£çµï¼‰", good:true},
  {t:"ä¾›æ‡‰å•†å°å¸³/è«‹æ¬¾/ä¿å›ºæ–‡ä»¶é½Šå…¨", good:true},
  {t:"ç§»äº¤å®Œæˆï¼šOwner/ReviewDate/å­˜æ”¾è·¯å¾‘å¯«æ˜", good:true},
  {t:"æ•™è¨“å­¸ç¿’æœƒè­°å®Œæˆä¸¦å…¥åº«", good:true},
  {t:"æœ€çµ‚KPIèˆ‡å·®ç•°åˆ†æå®šç¨¿", good:true},
  {t:"é¢¨éšªæ®˜ç•™å·²æŒ‡å®šOwnerèˆ‡è¿½è¹¤æ—¥ç¨‹", good:true},
  {t:"çµæ¡ˆå…¬å‘Šç™¼å¸ƒï¼ˆå°å…§/å°å¤–ï¼‰", good:true},
  {t:"å¤§å®¶éƒ½è¦ºå¾—å¾ˆåœ“æ»¿", good:false},
  {t:"å¥½åƒå·®ä¸å¤šå¯ä»¥çµæŸäº†", good:false},
  {t:"ç…§ç‰‡èˆ‡å½±ç‰‡æ•´ç†æ­¸æª”ï¼ˆæ¬Šé™è¨­å®šå®Œæˆï¼‰", good:true},
  {t:"æ“¬å®šæœªä¾†ä¹Ÿè¦æ›´åŠªåŠ›", good:false},
  {t:"è³‡æ–™ä¿å­˜/éŠ·æ¯€ç­–ç•¥åŸ·è¡Œè­‰æ˜", good:true},
  {t:"æ±ºç­–æ¸…å–®èˆ‡ä¾æ“šå…¥åº«ï¼ˆDecision Logï¼‰", good:true},
  {t:"éš¨ç·£å³å¯", good:false}
];

const assets = [
  "æºç¢¼/åŸå§‹æª”/è¨­è¨ˆæª”",
  "å¯åŸ·è¡ŒåŒ…/éƒ¨ç½²è…³æœ¬/å›æ»¾æ–¹æ¡ˆ",
  "å¸³è™Ÿ/æ¬Šé™æ¸…å†Š",
  "Runbook/SOP",
  "SLA/ç¶­è­·çª—å£/å€¼ç­è¡¨",
  "åˆç´„/ä¿å›º/æˆæ¬Šæ–‡ä»¶",
  "ä½¿ç”¨è€…æ–‡ä»¶/FAQ",
  "ç¨½æ ¸Log/ç›£æ§å„€è¡¨æ¿é€£çµ"
];

const messyFiles = [
  "final_final_report_v3(çœŸçš„æœ€å¾Œ).pptx",
  "IMG_20241211_134233.JPG",
  "doc1.docx",
  "å ±å‘Šnewæœ€æ–°æœ€çµ‚ç‰ˆ.pptx",
  "meeting_notes(å°ç¾).txt"
];

// --- å°èˆª ---
const sections = [
  {id:"lv1", name:"1 æ±ºç­–æ¨¹"},
  {id:"lv2", name:"2 DOR æ‹–æ”¾"},
  {id:"lv3", name:"3 DOD å‹¾é¸"},
  {id:"lv4", name:"4 ç§»äº¤æ¨¡æ“¬"},
  {id:"lv5", name:"5 æ•™è¨“â†’æ¨¡æ¿"},
  {id:"lv6", name:"6 æ‰¾å¾—åˆ°"},
  {id:"summary", name:"ç¸½çµ/åŒ¯å‡º"}
];
const nav = document.getElementById('nav');
sections.forEach((s,i)=>{
  const a=document.createElement('a');
  a.href="#"; a.textContent=s.name; a.dataset.to=s.id; if(i===0) a.classList.add('active');
  a.onclick=(e)=>{e.preventDefault(); show(s.id)}; nav.appendChild(a);
});
function show(id){
  document.querySelectorAll('section').forEach(sec=>sec.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.nav a').forEach(a=>a.classList.toggle('active', a.dataset.to===id));
  if(id==='summary') renderPreview();
}

// --- åˆ†æ•¸ ---
function addScore(n){ state.score += n; document.getElementById('score').textContent = state.score; }

// --- Lv1 ---
const drawBtn = document.getElementById('drawScenario');
const scenarioBox = document.getElementById('scenarioBox');
const decisionBox = document.getElementById('decisionBox');
const scenarioTag = document.getElementById('scenarioTag');

drawBtn.onclick = ()=>{
  const s = scenarios[Math.floor(Math.random()*scenarios.length)];
  state.lv1.scenario = s; state.lv1.answers={};
  scenarioTag.textContent = s.title;
  scenarioBox.innerHTML = `<div class="small">äº‹å¯¦ï¼š${s.facts.map(f=>`<span class="tag">${f}</span>`).join(' ')}</div>`;
  decisionBox.innerHTML = '';
  s.questions.forEach(q=>{
    const row=document.createElement('div'); row.className='check';
    row.innerHTML = `<div class="small">${q.q}</div>
      <div class="right flex">
        <label class="flex"><input type="radio" name="${q.k}" value="yes"> <span class="small">æ˜¯</span></label>
        <label class="flex"><input type="radio" name="${q.k}" value="no"> <span class="small">å¦</span></label>
      </div>`;
    decisionBox.appendChild(row);
  });
};

// --- Lv2 DOR Drag ---
const dorPoolBox = document.getElementById('dorPool');
function makeItem(text){ const d=document.createElement('div'); d.className='item'; d.draggable=true; d.textContent=text; d.addEventListener('dragstart',ev=>{ev.dataTransfer.setData('text/plain', text);}); return d; }
function renderDorPool(){ dorPoolBox.innerHTML=''; dorPool.forEach(t=> dorPoolBox.appendChild(makeItem(t))); }
renderDorPool();

document.querySelectorAll('.col').forEach(col=>{
  col.addEventListener('dragover', ev=> ev.preventDefault());
  col.addEventListener('drop', ev=>{
    ev.preventDefault(); const t = ev.dataTransfer.getData('text/plain');
    const bucket = col.dataset.bucket; if(!state.lv2.buckets[bucket].includes(t)) state.lv2.buckets[bucket].push(t);
    const el = makeItem(t); col.appendChild(el);
  });
});

document.getElementById('addDor').onclick = ()=>{
  const v = document.getElementById('customDor').value.trim();
  if(!v) return; dorPool.push(v); renderDorPool(); document.getElementById('customDor').value='';
};

// --- Lv3 DOD checklist ---
const dodList = document.getElementById('dodList');
const dodNotes = document.getElementById('dodNotes');
function renderDod(){
  dodList.innerHTML='';
  dodPool.forEach((d,i)=>{
    const wrap=document.createElement('div'); wrap.className='check';
    wrap.innerHTML = `<input type="checkbox" data-i="${i}"> <div>${d.t} ${d.good?'<span class="ok">(å¯æª¢æ ¸)</span>':'<span class="bad">(å£è™Ÿ/ä¸å¯æª¢æ ¸)</span>'}</div>`;
    dodList.appendChild(wrap);
  });
  dodNotes.innerHTML='';
  for(let k=0;k<3;k++){ const r=document.createElement('div'); r.className='check'; r.innerHTML=`<input placeholder="æ¢ç›®åç¨±"> <input placeholder="è­‰æ“š/é€£çµ/æª”æ¡ˆ">`; dodNotes.appendChild(r);}  
}
renderDod();

dodList.addEventListener('change', (e)=>{
  if(e.target.matches('input[type="checkbox"]')){
    const i=+e.target.dataset.i; const t=dodPool[i].t;
    if(e.target.checked){ if(!state.lv3.chosen.includes(t)) state.lv3.chosen.push(t); }
    else{ state.lv3.chosen = state.lv3.chosen.filter(x=>x!==t); }
  }
});

// --- Lv4 assets ---
const assetList = document.getElementById('assetList');
assets.forEach((a,idx)=>{
  const row=document.createElement('label'); row.className='check';
  row.innerHTML = `<input type="checkbox" data-asset="${a}"> <div>${a}</div>`;
  assetList.appendChild(row);
});
assetList.addEventListener('change', (e)=>{
  if(e.target.matches('input[type="checkbox"]')){
    const a=e.target.dataset.asset; if(e.target.checked){ if(!state.lv4.assets.includes(a)) state.lv4.assets.push(a);} else { state.lv4.assets = state.lv4.assets.filter(x=>x!==a);} }
});

// --- Lv5 rewrite helper (ç°¡æ˜“è¦å‰‡ï¼ŒæŠŠå¥å­è½‰å¥å‹) ---
function rewriteLines(txt){
  return txt.split(/\n+/).map(s=>s.trim()).filter(Boolean).map((s,i)=>{
    let noun=s.replace(/[ã€‚.!?]$/,'');
    return `${i+1}. ${noun} å·²å»ºç«‹å°æ‡‰æ§åˆ¶ï¼ˆè­‰æ“šï¼šé€£çµ/æˆªåœ–/æª”åï¼‰`;
  }).join('\n');
}

document.getElementById('autoRewrite').onclick=()=>{
  const src=document.getElementById('lessonsSrc').value; document.getElementById('lessonsOut').value = rewriteLines(src);
};

// --- Lv6 files rename ---
const fileList = document.getElementById('fileList');
function renderFiles(){
  fileList.innerHTML='';
  messyFiles.forEach((f,i)=>{
    const row=document.createElement('div'); row.className='grid2';
    row.innerHTML = `<div class="check"><div>åŸæª”åï¼š<span class="tag">${f}</span></div></div>
      <div class="check">
        <div class="small">æ–°æª”åï¼ˆæ ¼å¼ï¼šä¸»é¡Œ-åˆ¶å“-ç‰ˆæœ¬-æ—¥æœŸ-Ownerï¼‰</div>
        <input data-file="${i}" placeholder="ä¾‹å¦‚ï¼šå°¾ç‰™-çµæ¡ˆå ±å‘Š-v1.0-2025-12-01-JF">
        <div class="small">æ¨™ç±¤ï¼ˆâ‰¤5ï¼Œç”¨é€—è™Ÿåˆ†éš”ï¼‰</div>
        <input data-tags="${i}" placeholder="#æ´»å‹•ç®¡ç†,#æ•™è¨“å­¸ç¿’,#æ¨¡æ¿">
      </div>`;
    fileList.appendChild(row);
  });
}
renderFiles();

// --- å®Œæˆé—œå¡ ---
function finish(id){
  if(state.finished[id]){ alert('å·²å®Œæˆï¼Œå¯é‡åšä½†ä¸å†åŠ åˆ†'); return; }
  // è¼•é‡é©—è­‰
  if(id==='lv1'){
    document.querySelectorAll('#decisionBox input[type=radio]:checked').forEach(r=>{ state.lv1.answers[r.name]=r.value; });
    state.lv1.script = document.getElementById('closureScript').value.trim();
    if(!state.lv1.script) return alert('è«‹å¯« 6 å¥è©±æºé€šç¨¿');
  }
  if(id==='lv2'){
    const need = state.lv2.buckets['å¿…å‚™'] || []; if(need.length<4) return alert('è‡³å°‘æ”¾ 4 æ¢åœ¨ã€Œå¿…å‚™ã€');
  }
  if(id==='lv3'){
    const c = state.lv3.chosen.length; if(c<10 || c>12) return alert('è«‹å‹¾é¸ 10â€“12 æ¢ DOD');
    const notes=[...document.querySelectorAll('#dodNotes .check')].map(el=>({k:el.querySelector('input:nth-child(1)').value.trim(), v:el.querySelector('input:nth-child(2)').value.trim()}));
    if(notes.filter(n=>n.k&&n.v).length<2) return alert('è‡³å°‘å° 2â€“3 æ¢è£œå……è­‰æ“šèªªæ˜');
    state.lv3.notes = notes;
  }
  if(id==='lv4'){
    state.lv4.owner=document.getElementById('owner').value.trim();
    state.lv4.review=document.getElementById('review').value;
    state.lv4.repo=document.getElementById('repo').value.trim();
    if(!state.lv4.owner || !state.lv4.review || state.lv4.assets.length<5) return alert('è«‹å¡« Owner/ReviewDate ä¸¦å‹¾è‡³å°‘ 5 é …è³‡ç”¢');
  }
  if(id==='lv5'){
    state.lv5.src=document.getElementById('lessonsSrc').value.trim();
    state.lv5.out=document.getElementById('lessonsOut').value.trim();
    if(!state.lv5.out) return alert('è«‹å®Œæˆ SOP/Checklist æ–‡æœ¬');
  }
  if(id==='lv6'){
    const files=[...document.querySelectorAll('#fileList [data-file]')].map(inp=>({name:inp.value.trim(), tags: (document.querySelector(`[data-tags="${inp.dataset.file}"]`).value||'').trim()}));
    if(files.some(f=>!f.name)) return alert('è«‹ç‚ºæ‰€æœ‰æª”æ¡ˆé‡æ–°å‘½å');
    state.lv6.files=files;
  }
  state.finished[id]=true; addScore(15); alert('å®Œæˆï¼æ­¤é—œ +15 åˆ†');
}

// ç¶å®šå®ŒæˆæŒ‰éˆ•
[...document.querySelectorAll('[data-finish]')].forEach(btn=> btn.addEventListener('click', ()=> finish(btn.dataset.finish)));

// åŒ¯å‡º Markdown
function renderPreview(){
  const md = genMarkdown();
  document.getElementById('preview').innerHTML = `<pre class="small" style="white-space:pre-wrap">${escapeHtml(md)}</pre>`;
}

function genMarkdown(){
  return `# Project Closure Quest æˆæœ\n\nç¸½åˆ†ï¼š${state.score}\nå·²å®Œæˆé—œå¡ï¼š${Object.keys(state.finished).join(', ')}\n\n## Lv1 æ±ºç­–æ¨¹\næƒ…å¢ƒï¼š${state.lv1.scenario?state.lv1.scenario.title:''}\nç­”æ¡ˆï¼š${JSON.stringify(state.lv1.answers)}\n\n### 6å¥è©±çµ‚æ­¢æºé€šç¨¿\n${state.lv1.script}\n\n## Lv2 DOR-Close åˆ†é¡\n${Object.entries(state.lv2.buckets).map(([k,v])=>`- ${k}: ${v.join('ã€')}`).join('\n')}\n\n## Lv3 DOD-Close é¸é …\n- å‹¾é¸ï¼š${state.lv3.chosen.join('ã€')}\n- è£œè¿°ï¼š\n${(state.lv3.notes||[]).map(n=>`  - ${n.k}: ${n.v}`).join('\n')}\n\n## Lv4 ç§»äº¤\n- Ownerï¼š${state.lv4.owner}\n- Review Dateï¼š${state.lv4.review}\n- Repo/Pathï¼š${state.lv4.repo}\n- è³‡ç”¢ï¼š${state.lv4.assets.join('ã€')}\n\n## Lv5 SOP/Checklist\n${state.lv5.out}\n\n## Lv6 å‘½å/æ¨™ç±¤\n${(state.lv6.files||[]).map(f=>`- ${f.name} | tags: ${f.tags}`).join('\n')}\n`;
}

function escapeHtml(s){ return s.replace(/[&<>]/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;'}[c])); }

function download(filename, text){
  const a=document.createElement('a'); a.setAttribute('href','data:text/markdown;charset=utf-8,'+encodeURIComponent(text)); a.setAttribute('download', filename); a.click();
}

document.getElementById('exportMd').onclick=()=>{ download('closure-quest-output.md', genMarkdown()); show('summary'); };

document.getElementById('reset').onclick=()=>{ if(confirm('ç¢ºèªé‡ç½®ï¼Ÿ')) location.reload(); };

// åˆå§‹è¼‰å…¥ï¼šè‡ªå‹•æŠ½ä¸€å¼µæƒ…å¢ƒ
drawBtn.click();

// Lv1 å¿«é€Ÿç”¢ç”Ÿå™¨
function buildClosureScript(){
  const aud = document.getElementById('q_aud').value || 'å…¨é«”åŒä»';
  const type = document.getElementById('q_type').value || 'æ­£å¸¸çµæ¡ˆ';
  const data = (document.getElementById('q_data').value || 'ä¾æ“šå°ˆæ¡ˆKPIèˆ‡æˆæœ¬/é¢¨éšªè©•ä¼°').trim();
  const mit = (document.getElementById('q_mit').value || 'å·²å®Œæˆè³‡æ–™å‚™æ´èˆ‡åˆç´„ä¿å›ºå®‰æ’').trim();
  const next = (document.getElementById('q_next').value || 'å¾ŒçºŒé‡Œç¨‹ç¢‘å°‡ä¾æ™‚é–“è¡¨åŸ·è¡Œ').trim();
  const contact = (document.getElementById('q_contact').value || 'å°ˆæ¡ˆçª—å£å°‡æŒçºŒæä¾›å”åŠ©').trim();
  const s = state.lv1.scenario ? state.lv1.scenario.title : type;
  const lines = [
    `1) è¦ªæ„›çš„${aud}ï¼Œæœ¬å°ˆæ¡ˆå°‡æ¡å–ã€Œ${type}ã€ï¼šæƒ…å¢ƒâ€”${s}ã€‚`,
    `2) æ±ºç­–ä¾æ“šï¼š${data}ã€‚`,
    `3) é¢¨éšªèˆ‡å½±éŸ¿ï¼šç¶“è©•ä¼°å¾Œæ–¼å¯æ¥å—ç¯„åœï¼Œé—œéµé¢¨éšªçš†æœ‰å°ç­–ã€‚`,
    `4) è£œæ•‘èˆ‡æ”¯æ´ï¼š${mit}ã€‚`,
    `5) å¾ŒçºŒé‡Œç¨‹ç¢‘ï¼š${next}ã€‚`,
    `6) è¯çµ¡çª—å£ï¼š${contact}ã€‚`
  ].join('
');
  document.getElementById('closureScript').value = lines;
}

const qb = document.getElementById('quickBuild');
if(qb){ qb.addEventListener('click', (e)=>{ e.preventDefault(); buildClosureScript(); }); }
</script>
</body>
</html>
